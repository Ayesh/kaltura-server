<!DOCTYPE html>
<html>
<head >
    <title>Kaltura Zoom connector</title>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/4.5.2/css/bootstrap.min.css">
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.2.1/jquery.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.16.0/umd/popper.min.js"></script>
    <script src="https://maxcdn.bootstrapcdn.com/bootstrap/4.5.2/js/bootstrap.min.js"></script>
    <script>
        var ks = '@ks@';
        var url = '@BaseServiceUrl@/api_v3/service/vendor_zoomvendor/action/submitRegistration';
        var accountId = '@accountId@';
    </script>
    <script>
        function trySubmit() {
            console.log("ddfdf");
            $("body").css("cursor", "progress");
            var $defaultUserId = $('#defaultUserId');
            var $zoomCategory  = $('#zoomCategory');
            var $zoomWebinarCategory  = $('#zoomWebinarCategory');
            var defaultUserId = $defaultUserId.val().trim();
            var zoomCategory = $zoomCategory.val().trim();
            var zoomWebinarCategory = $zoomWebinarCategory.val().trim();
            var enableRecordingUploadObj = $(".enableRecordingUpload");
            var enableWebinarUploadObj = $(".enableWebinarUpload");
            var createUserIfNotExistObj = $(".createUserIfNotExist");
            var enableRecordingUpload = enableRecordingUploadObj.is(":checked");
            var enableWebinarUpload = enableWebinarUploadObj.is(":checked");
            var createUserIfNotExist = createUserIfNotExistObj.is(":checked");
            var handleParticipantsMode = $('[name=participantsHandler]:checked').val();
            var zoomUserMatchingMode = $('[name=userMatchingHandler]:checked').val();
            var zoomUserPostfix = $('#zoomUserPostfix').val().trim();

            $.ajax({
                url : url,
                type : 'post',
                data: {"ks": ks, 'accountId' : accountId,
                    'integrationSetting:objectType' : 'KalturaZoomIntegrationSetting',
                    'integrationSetting:defaultUserId': defaultUserId, 'integrationSetting:zoomCategory' : zoomCategory,
                    'integrationSetting:enableRecordingUpload':enableRecordingUpload,
                    'integrationSetting:createUserIfNotExist':createUserIfNotExist,
                    'integrationSetting:handleParticipantsMode':handleParticipantsMode,
                    'integrationSetting:zoomUserMatchingMode':zoomUserMatchingMode,
                    'integrationSetting:zoomUserPostfix':zoomUserPostfix,
                    'integrationSetting:zoomWebinarCategory':zoomWebinarCategory,
                    'integrationSetting:enableWebinarUploads':enableWebinarUpload,
                    'format': 1 },
                success : function(res) {
                    $("body").css("cursor", "default");
                    console.log(res);
                    if(res){
                        if(res.objectType == 'KalturaAPIException')
                        {
                            onFail(res.message);
                        }
                        else
                        {
                            onSuccess();
                        }
                    }
                    else {
                        onSuccess();
                    }
                },
                error: function() {
                    $("body").css("cursor", "default");
                    console.log('err during api call');
                }
            });
        }
        function  onSuccess() {
            $('#submitError').hide();
            $('#submitOK').show();
        }
        function onFail(errorMessage) {
            $('#submitOK').hide();
            $('#submitError').show();
            $('#submitError').html(errorMessage);
        }
    </script>
    <title>Kaltura-Zoom registration</title>
</head>
<body>
    <form>
        <div class="col-sm-2"></div>
        <div class="container col-sm-8">
            <div class="imgcontainer">
                <img src="https://upload.wikimedia.org/wikipedia/commons/f/f7/KalturaLogo_Updatedpng.png" width="128" class="mx-auto d-block">
            </div>
            <div class="form-group">
                <label><b>Default User ID</b></label>
                <input type="text" value="@defaultUserID@" id="defaultUserId" class="form-control" name="defaultUserId" required>
            </div>
            <div class="form-group">
                <label for="zoomCategory"><b>Zoom Category</b></label>
                <input type="text" value="@zoomCategory@" id="zoomCategory" class="form-control" name="zoomCategory" required>
            </div>
            <div class="form-group">
            <label for="zoomWebinarCategory"><b>Zoom Webinar Category</b></label>
                <input type="text" value="@zoomWebinarCategory@" id="zoomWebinarCategory" class="form-control" name="zoomWebinarCategory" required>
            </div>

            <div class="container p-3 my-3 border">
                <div class="custom-control custom-switch">
                    <input type="checkbox" class="custom-control-input" id="EnableRecordingUpload" name="EnableRecordingUpload">
                    <label class="custom-control-label" for="EnableRecordingUpload">Enable recording upload</label>
                </div>

                <div class="custom-control custom-switch">
                    <input type="checkbox" class="custom-control-input" id="EnableWebinarUpload" name="EnableWebinarUpload">
                    <label class="custom-control-label" for="EnableWebinarUpload">Enable webinar upload</label>
                </div>
            </div>


            <div class="form-group  container p-3 my-3 border">
                <h6 >Setting owner for recordings</h6>
                <div class="form-check">
                    <label class="form-check-label">
                    <input type="radio"  name="RecordingOwner" class="form-check-input" @IS_CHECKED@>
                        Based on Zoom User ID</label>
                </div>
                <div class="container-fluid p-3 my-2 mx-auto border" style="width: 540px;">
                    <p class="form-check-label">How matching zoom users should be handled:</p>
                    <div class="form-check-inline">
                        <input type="radio" class="form-check-input"
                               name="userMatchingHandler" value="0"  checked>
                        <label class="form-check-label">Do not modify</label>
                    </div>
                    <div class="form-check-inline">
                        <input type="radio" class="form-check-input"
                               name="userMatchingHandler" value="1">
                        <label class="form-check-label">Add postfix</label>
                    </div>
                    <div class="form-check-inline">
                        <input type="radio" id="userMatchingHandler3" class="form-check-input"
                               name="userMatchingHandler" value="2">
                        <label for="userMatchingHandler3" class="form-check-label">Remove postfix</label>
                    </div>
                    <div class="form-group">
                        <label class="form-check-label"> User matching postfix</label>
                        <input type="text" value="" id="zoomUserPostfix" class="form-control" name="zoomUserPostfix">
                    </div>
                </div>
                <div class="form-check">
                    <label class="form-check-label">
                        <input type="radio"  name="RecordingOwner" class="form-check-input" @IS_CHECKED@>
                        Based on cms_user_id (SAML mapping)</label>
                </div>
            </div>
            <div class="form-group container p-3 my-3 border">
                <p class="form-check-label">How meeting participants should be handled:</p>
                <div class="form-check-inline">
                    <label class="form-check-label">
                    <input type="radio" id="participantsChoice1" class="form-check-input"
                           name="participantsHandler" value="0"  checked>Add as Co publishers </label>
                </div>
                <div class="form-check-inline">
                    <label class="form-check-label">
                    <input type="radio" id="participantsChoice2" class="form-check-input"
                           name="participantsHandler" value="1">Add as Co viewers </label>
                </div>
                <div class="form-check-inline">
                    <label class="form-check-label">
                    <input type="radio" id="participantsChoice3" class="form-check-input"
                           name="participantsHandler" value="2">Ignore participants </label>
                </div>
            </div>

            <p id="submitError" class="error" style="display:none">Data was Not Saved , please check server logs'.</p>
            <p id="submitOK" class="success" style="display:none">Saved Successfully</p>
            <button type="button" id="submitBtn" class="btn btn-block btn-primary" onclick="trySubmit()">Submit</button>
        </div>
        <div class="col-sm-2"></div>
    </form>
</body>
</html>
